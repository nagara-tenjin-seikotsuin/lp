# 長良天神整骨院 ランディングページ 要件定義書（逆生成）

## 分析概要

| 項目 | 内容 |
|------|------|
| **分析日時** | 2026-02-15 |
| **対象コードベース** | `/Users/cochumo/Documents/develop/nagara-tenjin-seikotsuin/lp` |
| **抽出要件数** | 機能要件 14個、非機能要件 10個 |
| **信頼度** | 85%（テストコード未実装のため実装コードからの推定） |

## システム概要

### 推定されたシステム目的

長良天神整骨院の集客を目的としたランディングページ。慢性的な痛みに悩む潜在顧客に対し、院の特徴・実績・口コミを訴求し、予約（コンバージョン）へ誘導することを目的とする。

**キャッチコピー**: 『その"慢性的な痛み"もう我慢しなくていいんです。ただの整骨院じゃない。再発させない"本質ケア"がここにあります。』

### 対象ユーザー

| ユーザー種別 | 説明 |
|------------|------|
| **潜在顧客** | 肩こり・腰痛・姿勢の悩みなど慢性的な痛みを抱える一般ユーザー |
| **スポーツ利用者** | けがのケアやトレーニング指導を求める競技者・その保護者 |
| **産後の女性** | 産後の骨盤矯正を必要とする方 |
| **院の運営者** | アクセス解析・A/Bテストの結果を確認するマーケティング担当者 |

---

## 機能要件（EARS記法）

### 通常要件（SHALL）

#### REQ-001: ファーストビュー表示

システムは、ランディングページのファーストビューとしてヒーロー画像と予約CTAボタンを表示しなければならない。

**実装根拠**:
- `src/pages/index.astro:11-20` — FVセクション
- `src/assets/fv.png` — ヒーロー画像
- `src/components/Cv.astro` — CTAボタン

#### REQ-002: 施術の特徴・解決策の提示

システムは、院の施術内容や悩みの解決策を視覚的に提示しなければならない。

**実装根拠**:
- `src/pages/index.astro:21-27` — solutionセクション
- `src/assets/solution.png` — 解決策画像（1.1MB）

#### REQ-003: 顧客レビューの表示

システムは、Google口コミレビューを星評価・テキスト付きで表示しなければならない。

**実装根拠**:
- `src/components/Reviews.astro` — レビューコンポーネント
- `src/constants/reviews.ts` — 5件のレビューデータ（全て★5評価）
- Google評価4.9（59件）のサマリー表示

#### REQ-004: 予約導線（CTA）の配置

システムは、ページ内の複数箇所に予約CTAボタンを配置しなければならない。

**実装根拠**:
- `src/components/Cv.astro` — CTAコンポーネント
- `src/pages/index.astro` — 4箇所（FV直下、レビュー下、エビデンス下、チェック下）に配置
- 遷移先: `https://airrsv.net/nagara-tenjin-seikotsuin/calendar`（外部予約システム）
- 新しいタブで開く（`target="_blank"`）

#### REQ-005: 実績・エビデンスの表示

システムは、院の実績・資格・信頼性の根拠を表示しなければならない。

**実装根拠**:
- `src/pages/index.astro:41-49` — evidenceセクション
- `src/assets/evidence.png` — エビデンス画像（2.2MB）

#### REQ-006: チェックリスト表示

システムは、対象症状や該当条件のチェックリストを表示しなければならない。

**実装根拠**:
- `src/pages/index.astro:50-66` — checkセクション
- `src/assets/check.png` — チェックリスト画像（1.1MB）
- `src/assets/cv-header.png` — コンバージョンヘッダー画像

#### REQ-007: FAQ（よくある質問）表示

システムは、よくある質問とその回答を表示しなければならない。

**実装根拠**:
- `src/pages/index.astro:68-74` — FAQセクション
- `src/assets/faq.png` — FAQ画像

#### REQ-008: アクセス情報・地図表示

システムは、院のアクセス情報とGoogleマップを表示しなければならない。

**実装根拠**:
- `src/pages/index.astro:75-82` — accessセクション
- `src/components/Map.astro` — Google Maps埋め込み
- `src/assets/access.png` — アクセス情報画像

#### REQ-009: ヘッダー・フッター表示

システムは、全ページにヘッダーとフッターを表示しなければならない。

**実装根拠**:
- `src/components/Header.astro` — ヘッダー画像
- `src/components/Footer.astro` — フッター画像
- `src/layouts/Layout.astro:112-116` — レイアウトで組み込み

#### REQ-010: A/Bテスト基盤

システムは、訪問者をA/Bテストのバリアント（A・B）にランダムに振り分ける機能を提供しなければならない。

**実装根拠**:
- `src/_middleware.ts` — A/Bテストミドルウェア
- `src/config/ab-config.json` — 重み設定（A:50, B:50）
- Cookie `ab_variant` による30日間のバリアント固定

### 条件付き要件（WHEN / IF-THEN）

#### REQ-101: レビューテキストの展開/折りたたみ

レビューテキストが3行を超える場合、システムは「続きを読む」リンクで展開可能な状態で表示しなければならない。

**実装根拠**:
- `src/components/Reviews.astro:158-170` — `<details>` + `line-clamp-3` による展開/折りたたみ
- 「続きを読む」/ 「閉じる」の表示切替

#### REQ-102: A/BテストのQA機能

URLパラメータ `?ab=A` または `?ab=B` が指定された場合、システムは指定されたバリアントを強制的に割り当てなければならない。

**実装根拠**:
- `src/_middleware.ts:24-28` — QAパラメータによる強制指定
- `?abreset=1` によるCookieリセット機能

#### REQ-103: 本番環境のみのアナリティクス読み込み

本番環境（`import.meta.env.PROD === true`）の場合のみ、システムはアナリティクスコードを読み込まなければならない。

**実装根拠**:
- `src/layouts/Layout.astro:93-107` — `isProd` フラグによる条件分岐

#### REQ-104: レビューアバター画像のフォールバック

レビュー著者のアバター画像が読み込めない場合、システムはデフォルトのプレースホルダーアイコンを表示しなければならない。

**実装根拠**:
- `src/components/Reviews.astro:117` — `onerror` ハンドラによるSVGフォールバック

---

## 非機能要件

### パフォーマンス

#### NFR-001: 画像最適化

システムは、画像をAVIF・WebP形式に変換し、最適化された状態で配信しなければならない。

**実装根拠**:
- Astro `Picture` コンポーネントによる自動フォーマット変換（`formats={["avif", "webp"]}`）
- `sharp` ライブラリによる画像処理
- 全セクション画像に適用

#### NFR-002: 遅延読み込み

システムは、ビューポート外の画像に対して遅延読み込みを適用しなければならない。

**実装根拠**:
- `src/components/Reviews.astro:116` — レビューアバターの`loading="lazy"`
- `src/components/Map.astro:1` — Google Mapsの`loading="lazy"`

#### NFR-003: 静的サイト生成

システムは、静的サイト生成（SSG）により高速な初回表示を実現しなければならない。

**実装根拠**:
- Astro フレームワーク採用（デフォルトSSG）
- 最小限のクライアントサイドJavaScript

### SEO

#### NFR-101: OGP（Open Graph Protocol）対応

システムは、SNSシェア時に適切なタイトル・説明文・画像が表示されるようOGPメタタグを出力しなければならない。

**実装根拠**:
- `src/layouts/Layout.astro:49-90` — og:title, og:description, og:image, twitter:card等
- `public/ogp.png` — OGP画像

#### NFR-102: メタデータ設定

システムは、ページタイトル・説明文・著者情報・ファビコンを適切に設定しなければならない。

**実装根拠**:
- `src/config/confg.json` — サイトメタデータ設定
- `src/layouts/Layout.astro:35-46` — title, author, favicon
- `src/libs/textConverter.ts` — HTMLタグ除去ユーティリティ

### アナリティクス

#### NFR-201: Google Analytics（GA4）連携

システムは、本番環境でGoogle Analytics 4によるアクセス解析データを収集しなければならない。

**実装根拠**:
- `src/layouts/Layout.astro:93-96` — GA4タグ（G-236LZ5X6HY）
- 本番環境のみ読み込み

#### NFR-202: Microsoft Clarity連携

システムは、本番環境でMicrosoft Clarityによるヒートマップ・セッション録画データを収集しなければならない。

**実装根拠**:
- `src/layouts/Layout.astro:99-107` — Clarityタグ（tou2zelrre）
- 本番環境のみ読み込み

### デプロイ・運用

#### NFR-301: GitHub Pages自動デプロイ

システムは、mainブランチへのpush時にGitHub Pagesへ自動デプロイされなければならない。

**実装根拠**:
- `.github/workflows/astro.yml` — GitHub Actionsワークフロー
- `@withastro/action@v3` — Astro公式アクション
- 手動トリガー（workflow_dispatch）も対応

#### NFR-302: カスタムドメイン対応

システムは、カスタムドメイン `lp.nagara-tenjin-seikotsuin.com` で配信されなければならない。

**実装根拠**:
- `public/CNAME` — カスタムドメイン設定
- `astro.config.mjs` — `site: "https://lp.nagara-tenjin-seikotsuin.com"`

### ユーザビリティ

#### NFR-401: モバイルファースト表示

システムは、最大幅750pxのコンテナで中央寄せ表示し、モバイルデバイスでも適切に表示されなければならない。

**実装根拠**:
- `src/pages/index.astro:10` — `max-w-[750px] mx-auto`
- Tailwind CSSによるレスポンシブユーティリティ

---

## Edgeケース

### エラー処理

#### EDGE-001: アバター画像読み込みエラー

Google口コミの著者アバター画像が取得できない場合、Base64エンコードされたデフォルトSVGアイコンにフォールバックする。

**実装根拠**:
- `src/components/Reviews.astro:117` — `onerror` イベントハンドラ

#### EDGE-002: A/Bテスト不正パラメータ

URLパラメータ `?ab=` に不正な値（A/B以外）が指定された場合、パラメータを無視してランダム割り当てまたはCookie値を使用する。

**実装根拠**:
- `src/_middleware.ts:27` — `qaVariant = undefined` による不正値無視

### 境界値

#### EDGE-101: レビューテキスト長

レビューテキストが短い場合でも「続きを読む」UIが表示される（3行以下でもdetails要素は存在する）。

**実装根拠**:
- `src/components/Reviews.astro:158-170` — 全レビューに一律適用

#### EDGE-102: 星評価の部分表示

評価値が整数でない場合（例: 4.9）、部分的に塗りつぶされた星をCSS `clip-path` で表現する。

**実装根拠**:
- `src/components/Reviews.astro:57-83` — 部分星のclip-path計算ロジック

---

## 推定されていない要件

### 不明確な部分

以下の要件は実装から推定が困難なため、ステークホルダーとの確認が必要：

1. **ビジネス要件**
   - コンバージョン目標値（予約件数/月）
   - A/Bテストで検証したい仮説・KPI
   - バリアントBの具体的な表示内容（現在はUIでの分岐未実装）

2. **コンテンツ要件**
   - 画像コンテンツの更新頻度・運用フロー
   - レビューデータの更新タイミング（現在はハードコーディング）
   - 価格情報・営業時間等の動的更新の必要性

3. **法的・コンプライアンス要件**
   - 医療広告ガイドラインへの準拠状況
   - Cookie同意バナーの要否
   - プライバシーポリシー・利用規約の必要性

4. **セキュリティ要件**
   - 環境変数（Google Maps API Key）の露出リスク管理
   - HTTPS強制の設定状況

---

## 分析の制約事項

### 信頼度に影響する要因

| 要因 | 影響 |
|------|------|
| **テストカバレッジ** | 0% — テストコード未実装 |
| **ドキュメント不足** | 要件定義書・仕様書が存在しない |
| **画像ベースのコンテンツ** | 大部分のコンテンツが画像のため、テキスト内容の正確な把握が困難 |
| **A/Bテスト未活用** | 基盤は実装済みだが、UIでの分岐は未実装 |

### 推定の根拠レベル

| レベル | 対象要件 | 説明 |
|--------|---------|------|
| **強い根拠** | REQ-001〜009, NFR-001〜402 | 実装コードから明確に確認 |
| **中程度の根拠** | REQ-010, REQ-102 | 実装済みだがUI側の活用が未確認 |
| **弱い根拠** | EDGE-101 | 想定される挙動だが意図的かは不明 |
